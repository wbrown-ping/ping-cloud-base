filter {
    if [kubernetes][container_name] == "kube-proxy" {
        mutate {
            add_field => {"[@metadata][index]" => "kube-proxy"}
        }
        grok {
            match => { 
                "log" => [
                    "%{WORD:loglevel}%{SPACE}%{TIMESTAMP_ISO8601:log_timestamp}%{SPACE}%{NUMBER:pid}%{SPACE}%{WORD:source_file}\:%{NUMBER:line_number}\]%{SPACE}%{QUOTEDSTRING:message}%{SPACE}elapsed\=%{NUMBER:elapsed_time}ms",
                    "%{WORD:loglevel}%{SPACE}%{TIMESTAMP_ISO8601:log_timestamp}%{SPACE}%{NUMBER:pid}%{SPACE}%{WORD:source_file}\:%{NUMBER:line_number}\]%{SPACE}%{QUOTEDSTRING:message}",
                    "%{WORD:loglevel}%{SPACE}%{TIMESTAMP_ISO8601:log_timestamp}%{SPACE}%{NUMBER:pid}%{SPACE}%{WORD:source_file}\:%{NUMBER:line_number}\]%{SPACE}%{QUOTEDSTRING:message}%{SPACE}numServices\=%{NUMBER:num_services}%{SPACE}numEndpoints\=%{NUMBER:num_endpoints}%{SPACE}numFilterChains\=%{NUMBER:num_filter_chains}%{SPACE}numFilterRules\=%{NUMBER:num_filter_rules}%{SPACE}numNATChains\=%{NUMBER:num_nat_chains}%{SPACE}numNATRules\=%{NUMBER:num_nat_rules}"
                ]
            }
        }
        date {
            match => [ "time", "ISO8601" ]
            target => "@timestamp"
        }
        mutate {
            rename => { "log_timestamp" => "event_time" }
            rename => { "loglevel" => "log_level" }
            rename => { "message" => "log_message" }
            convert => { "elapsed_time" => "float" }
            convert => { "num_services" => "integer" }
            convert => { "num_endpoints" => "integer" }
            convert => { "num_filter_chains" => "integer" }
            convert => { "num_filter_rules" => "integer" }
            convert => { "num_nat_chains" => "integer" }
            convert => { "num_nat_rules" => "integer" }
        }
    }
}